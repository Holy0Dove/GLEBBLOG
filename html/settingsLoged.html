<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Gleb Blog</title>
        <link rel="stylesheet" href="style.css">
    </head>
<body>
    <header >
        <div class="color">
        <div class="logo"><h1>GLEB BLOG SETTINGS<h1></div>

      <div class="Profile">
        <div style="display:grid;">
            
           <div><button onclick="logout()" class="exit">logout</button></div>
            <div><button>MyProfile</button></div>
            <div><button onclick="goBack()">GoBack?</button></div>
        </div>
        <div style="text-align: center;">
            <div id="username"></div>
            
            <div class="image" ><img  width="70px" src="https://www.partyrama.co.uk/wp-content/plugins/partyrama-ecommerce-pro/includes/pro-images/prod-img/default/shreks-mini-cardboard-cutout-product-image.jpg"></div>
        </div>
      </div>
      
    </div>
    
    </header>

    <main>
        <div class="settingsBackground">
        <div class="settings">
            <div>change login & username</div>
            
            
            <input id="newLogin">
            <br/>
            <button onclick="changeLogin()">sumbit</button>
            <hr> 
            <div>change password </div>
             <input>
             <input>
             <br/>
             <button>sumbit</button>
            <hr> 
            <div>delete account</div>
            <input type="checkbox"> <button class="exit">SURE?</button>
        </div>
        </div>
    </main>

    <script>
         const getUser = ()=>
        {
            fetch("/getUser",{
                method:"GET"
            }).then(answer => answer.text()).then(userData=>{
                const user = JSON.parse(userData) 
                document.getElementById("username").innerText= user.login
                

            })
        }
        const logout=()=>{
            fetch("/logout",{
            method:"DELETE"
            
             }).then(answer=>{
            location.reload()
        })}

        const goBack=()=>{
            window.location.href="/main"
        }

        const changeLogin=()=>{
           const login = document.getElementById("newLogin").value


            if(login){
                fetch("/changeData",{
                    method:"PATCH",
                    body:JSON.stringify({
                        whatNeedChange:"login",
                        data:login
                    })}).then(answer => answer.text())
                    .then(
                        parsedAnswer => {
                            if (parsedAnswer){
                                logout()
                                
                            }else 
                            {alert("something goes wrong")}
                        }
                    ).catch(err=>alert(err))
                }
            

            else{
                alert("bro, its empty")
            }
        }
getUser()
    </script>
</body>
</html>